# -*- coding: utf-8 -*-


def check_pw(password):
    code = "icffjcifkcjflckfmclfncmfocnfpcofqcpfrcqfscrftcsfuctfvcufwcvfxcwfycxfzcyfAczfBcAfCcBfDcCfEcDfFcEfGcFfHcGfIcHfJcIfKcJfLcKfMcLfNcMMOcNNPcONQcPMRcQiScRkTcNoUcTMVcToWcVwXcVkYcUfZcYiАcZkБcPfВcБkГcВoДcOfЕcДiЁcЕoЖcЁwЗcЖMИcЕfЙcИiКcЖoЛcКwМcXiНcМoОcЛiПcMfРcПkСcЗkТcSiУcТkФcУwХcWfЦcХiЧcЦkШcУfЩcШiЪcЩoЫcАfЬcЫiЭcВfЮcГfЯcЮfІcЯwѢcRfѲcФfѴcѲiаcЬoбcРfвcЪfгcвiдcШfзcZfжdзeиdХeжcжикcзfйdкeжcжймcХfлdмeжcжлоcЦfнdоeжcжнжcжипdMeжcжпсcЬmрdсeжcжруcбmтdуeжcжтхcбkфdхeжcжфчcНfцdчeжcжцщcуuшdщeжcжшыcоfъdыeъcърьdыeъcъьэdЦeъcъэяcбiюdяeъcъюъcъръcътъcъпіdЧeъcъіѣdзeъcъѣѳdАeъcъѳъcълъcъиъcъѣθcЬfѵdθeъcъѵъcъюωcяfαdωeъcъαъcъαеcжъёbеeδdсeφcМlρdφeδcδργcуkτdγeδcδτηcφiψdηeδcδψυdНeδcδυδcδрδcδρκcγfιdκeδcδιδcδψσcжδεbσeπdсeπcπρπcπτπcπψνcаiμdνeπcπμπcπрπcπρπcπιπcπψοcжπλbοeχdUeχcχиχcχѵζdUeχcχζχcχѣΘdYeχcχΘχcχлΩcуiΑdΩeχcχΑχcχѵχcχζχcχиΕcκfΣdΕeχcχΣΡcΕjΔdΡeχcχΔΤcΡfΦdΤeχcχΦχcχюχcχрχcχΑχcχьΨcкfΓdΨeχcχΓχcχэχcχѳχcχнχcχьχcχюΥcбfΗdΥeχcχΗΚcθiΙdΚeχcχΙΛcθfΟdΛeχcχΟΜcыfΠdΜeχcχΠΒcуfΝdΒeχcχΝΧcΤiΞdΧeχcχΞχcχΗχcχαχcχαχcχΑχcχнχcχΘχcχіχcχьχcχѵχcχΟχcχюχcχαβcжχξbβeԲdθeԲcԲΟԳdЬeԲcԲԳԲcԲΙԲcԲэԲcԲΟԲcԲΑԲcԲΙԲcԲΓԴdЫeԲcԲԴԲcԲиԲcԲэԵdZeԲcԲԵԲcԲюԲcԲΗԶcΕfԷdԶeԲcԲԷԲcԲΣԹcNiԸdԹeԲcԲԸԲcԲΗԲcԲтԲcԲрԲcԲαΖcжԲԱbΖeԼdзeԼcԼиԼcԼйԼcԼлԼcԼнԼcԼиԼcԼпԼcԼрԼcԼтԾcсfԽdԾeԼcԼԽԼcԼшԿdяeԿcԿрԿcԿтԿcԿԽԿcԿαԺcԼԿԻbԺeՁdYeՁcՁйՁcՁԴՁcՁѳՁcՁԳՁcՁΟՁcՁпՁcՁѵՁcՁΟՁcՁԳՁcՁΙՁcՁэՁcՁΟՀёՁeՂdYeՂcՂйՂcՂԴՂcՂѳՂcՂԳՂcՂΟՂcՂпՂcՂζՂcՂиՂcՂѵՂcՂζՂcՂѣՂcՂΘՂcՂлՀёՂeՀceeՃξgeՃԱՃeՄceeՅceeՆceeՇceeՄaՃeՆԻՄSՅεՆeՇԻՅhhλՇeՄaՃfՆԻՄUՅεՆeՇԻՅhhλՇeՄaՃiՆԻՄWՅεՆeՇԻՅhhλՇeՄaՃjՆԻՄXՅεՆeՇԻՅhhλՇeՄaՃkՆԻՄАՅεՆeՇԻՅhhλՇeՄaՃlՆԻՄEՅεՆeՇԻՅhhλՇeՄaՃmՆԻՄГՅεՆeՇԻՅhhλՇeՄaՃnՆԻՄЗՅεՆeՇԻՅhhλՇeՄaՃoՆԻՄГՅεՆeՇԻՅhhλՇeՄaՃpՆԻՄЙՅεՆeՇԻՅhhλՇeՄaՃqՆԻՄЛՅεՆeՇԻՅhhλՇeՄaՃrՆԻՄНՅεՆeՇԻՅhhλՇeՄaՃsՆԻՄEՅεՆeՇԻՅhhλՇeՄaՃtՆԻՄОՅεՆeՇԻՅhhλՇeՄaՃuՆԻՄРՅεՆeՇԻՅhhλՇeՄaՃvՆԻՄСՅεՆeՇԻՅhhλՇeՄaՃwՆԻՄФՅεՆeՇԻՅhhλՇeՄaՃxՆԻՄЧՅεՆeՇԻՅhhλՇeՄaՃyՆԻՄЪՅεՆeՇԻՅhhλՇeՄaՃzՆԻՄЬՅεՆeՇԻՅhhλՇeՄaՃAՆԻՄЭՅεՆeՇԻՅhhλՇeՄaՃBՆԻՄVՅεՆeՇԻՅhhλՇeՄaՃCՆԻՄЮՅεՆeՇԻՅhhλՇeՄaՃDՆԻՄІՅεՆeՇԻՅhhλՇeՄaՃEՆԻՄѢՅεՆeՇԻՅhhλՇeՄaՃFՆԻՄѴՅεՆeՇԻՅhhλՇeՄaՃGՆԻՄаՅεՆeՇԻՅhhλՇeՄaՃHՆԻՄeՅεՆeՇԻՅhhλՇeՄaՃIՆԻՄбՅεՆeՇԻՅhhλՇeՄaՃJՆԻՄгՅεՆeՇԻՅhhλՇeՄaՃKՆԻՄJՅεՆeՇԻՅhhλՇeՄaՃLՆԻՄдՅεՆeՇԻՅhhλՇeՄceeՅceeՆceeՇceeёceeεceeλceeξceeԱceeԻceeъceeеceeδceeσceeπceeοceeχceeβceeԲceeΖceeԼceeԿceeԺceeՁceeՂceeՃcee"

    env = {
        "a": lambda x, y: x[y],
        "b": lambda x, _: eval(x),
        "c": lambda x, y: x + y,
        "d": lambda x, _: chr(x),
        "e": 0,
        "f": 1,
        "g": password,
        "h": 0,
    }

    for lhs, fn, arg1, arg2 in list(map("".join, zip(*[iter(code)] * 4))):
        env[lhs] = env[fn](env[arg1], env[arg2])

    return not env["h"]


def main():
    import argparse
    import hashlib
    import re

    from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
    from cryptography.hazmat.backends import default_backend

    parser = argparse.ArgumentParser(description="Python Safe 1.0")
    parser.add_argument(
        "password",
        metavar="password",
        type=str,
        help="password encrypting the password",
    )
    args = parser.parse_args()

    if match := re.search(r"^CTF{([0-9a-zA-Z_@!?-]+)}$", args.password):
        password = match.group(1)
        if check_pw(password):
            backend = default_backend()
            iv = b">\x1e\x8e\x8b\xd8\x9e\xfb\xd3:\x80\xfbb\x9e\xba\xfa\x1e"
            secret = b"\x1a\xd6\xff\xc9q-\x1d\xa4\xe6j/@\xccGI\x7f)\xb2=Z\xc3\x7fl\x03Y\xdd46\x047\xd4Y"
            pw_hash = hashlib.sha256(password.encode("utf-8")).digest()
            cipher = Cipher(algorithms.AES(pw_hash), modes.CBC(iv), backend=backend)
            decrypter = cipher.decryptor()
            decrypted_message = decrypter.update(secret) + decrypter.finalize()
            print(decrypted_message.decode("utf-8").strip())
        else:
            print("incorrect password!")
    else:
        print("incorrect password format!")


if __name__ == "__main__":
    main()
